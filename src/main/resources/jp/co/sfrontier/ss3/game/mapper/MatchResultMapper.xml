<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="jp.co.sfrontier.ss3.game.mapper.MatchResultMapper">
	<resultMap id="BaseResultMap"
		type="jp.co.sfrontier.ss3.game.model.MatchResult">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue Dec 02 
			12:03:59 JST 2025. -->
		<id column="MATCH_RESULT_ID" jdbcType="BIGINT"
			property="matchResultId" />
		<result column="ATTACKER_ID" jdbcType="BIGINT"
			property="attackerId" />
		<result column="DEFENDER_ID" jdbcType="BIGINT"
			property="defenderId" />
		<result column="GAME_ID" jdbcType="BIGINT" property="gameId" />
		<result column="MATCH_DATETIME" jdbcType="TIMESTAMP"
			property="matchDatetime" />
		<result column="JUDGE" jdbcType="INTEGER" property="judge" />
		<result column="CREATED_AT" jdbcType="TIMESTAMP"
			property="createdAt" />
		<result column="UPDATED_AT" jdbcType="TIMESTAMP"
			property="updatedAt" />
		<result column="VERSION" jdbcType="INTEGER" property="version" />
	</resultMap>
	<sql id="Base_Column_List">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue Dec 02 
			12:03:59 JST 2025. -->
		MATCH_RESULT_ID, ATTACKER_ID, DEFENDER_ID, GAME_ID, MATCH_DATETIME,
		JUDGE, CREATED_AT,
		UPDATED_AT, VERSION
	</sql>
	<select id="selectByPrimaryKey" parameterType="java.lang.Long"
		resultMap="BaseResultMap">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue Dec 02 
			12:03:59 JST 2025. -->
		select
		<include refid="Base_Column_List" />
		from GAME.MATCH_RESULT
		where MATCH_RESULT_ID =
		#{matchResultId,jdbcType=BIGINT}
	</select>
	<insert id="insert"
		parameterType="jp.co.sfrontier.ss3.game.model.MatchResult">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue Dec 02 
			12:03:59 JST 2025. -->
		<selectKey keyProperty="matchResultId" order="AFTER"
			resultType="java.lang.Long">
			CALL IDENTITY()
		</selectKey>
		insert into GAME.MATCH_RESULT (ATTACKER_ID, DEFENDER_ID, GAME_ID,
		MATCH_DATETIME, JUDGE, CREATED_AT,
		UPDATED_AT, VERSION)
		values
		(#{attackerId,jdbcType=BIGINT}, #{defenderId,jdbcType=BIGINT},
		#{gameId,jdbcType=BIGINT},
		#{matchDatetime,jdbcType=TIMESTAMP},
		#{judge,jdbcType=INTEGER}, #{createdAt,jdbcType=TIMESTAMP},
		#{updatedAt,jdbcType=TIMESTAMP}, #{version,jdbcType=INTEGER})
	</insert>
	<insert id="insertSelective"
		parameterType="jp.co.sfrontier.ss3.game.model.MatchResult">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue Dec 02 
			12:03:59 JST 2025. -->
		<selectKey keyProperty="matchResultId" order="AFTER"
			resultType="java.lang.Long">
			CALL IDENTITY()
		</selectKey>
		insert into GAME.MATCH_RESULT
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="attackerId != null">
				ATTACKER_ID,
			</if>
			<if test="defenderId != null">
				DEFENDER_ID,
			</if>
			<if test="gameId != null">
				GAME_ID,
			</if>
			<if test="matchDatetime != null">
				MATCH_DATETIME,
			</if>
			<if test="judge != null">
				JUDGE,
			</if>
			<if test="createdAt != null">
				CREATED_AT,
			</if>
			<if test="updatedAt != null">
				UPDATED_AT,
			</if>
			<if test="version != null">
				VERSION,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="attackerId != null">
				#{attackerId,jdbcType=BIGINT},
			</if>
			<if test="defenderId != null">
				#{defenderId,jdbcType=BIGINT},
			</if>
			<if test="gameId != null">
				#{gameId,jdbcType=BIGINT},
			</if>
			<if test="matchDatetime != null">
				#{matchDatetime,jdbcType=TIMESTAMP},
			</if>
			<if test="judge != null">
				#{judge,jdbcType=INTEGER},
			</if>
			<if test="createdAt != null">
				#{createdAt,jdbcType=TIMESTAMP},
			</if>
			<if test="updatedAt != null">
				#{updatedAt,jdbcType=TIMESTAMP},
			</if>
			<if test="version != null">
				#{version,jdbcType=INTEGER},
			</if>
		</trim>
	</insert>
	
	<select id="selectByAttackerId" resultMap="BaseResultMap">
		SELECT
		  <include refid="Base_Column_List" />
		  
		FROM
		  GAME.MATCH_RESULT
		  
		WHERE
		  ATTACKER_ID = #{attackerId}
		  
		AND
		  GAME_ID = #{gameId}
		  
		ORDER BY
		  MATCH_DATETIME DESC
	</select>
	
	<select id="selectRecentHistory"
	        resultType="jp.co.sfrontier.ss3.game.value.LookOverThereMatchHistory">

	    SELECT
	        MATCH_RESULT.MATCH_DATETIME AS matchDatetime,
	        ATTACKER.DISPLAY_NAME      AS attackerDisplayName,
	        DEFENDER.DISPLAY_NAME      AS defenderDisplayName,
	        MATCH_RESULT.JUDGE         AS judge
	    FROM
	        GAME.MATCH_RESULT MATCH_RESULT
	        JOIN GAME.GAME_USER ATTACKER
	          ON MATCH_RESULT.ATTACKER_ID = ATTACKER.GAME_USER_ID
	        JOIN GAME.GAME_USER DEFENDER
	          ON MATCH_RESULT.DEFENDER_ID = DEFENDER.GAME_USER_ID
	    WHERE
	        MATCH_RESULT.MATCH_DATETIME >= #{fromDate}
	      AND MATCH_RESULT.MATCH_DATETIME &lt; #{toDate}
	      AND MATCH_RESULT.ATTACKER_ID = #{playerId} 
	    ORDER BY
	        MATCH_RESULT.MATCH_DATETIME DESC
	    LIMIT 10
	</select>




</mapper>